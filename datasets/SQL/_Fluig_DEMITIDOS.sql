use corporerm
GO


SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW _Fluig_DEMITIDOS
AS

/* DEMITOS OU INVÁLIDOS NO RM */
SELECT	LOWER(CODUSUARIO) CODUSUARIO, CHAPA 
FROM	PFUNC JOIN PPESSOA on (PFUNC.CODPESSOA=PPESSOA.CODIGO)
WHERE	CODSITUACAO		IN ( 'D','I')
AND		CODUSUARIO		IN (		/* ATIVOS NO FLUIG */
							SELECT LOWER(T.LOGIN)  COLLATE Latin1_General_CI_AS as LOGIN
							FROM [RIOSRV013\sistema].[FLUIG_DB].[dbo].[FDN_USER] U
									JOIN [RIOSRV013\sistema].[FLUIG_DB].[dbo].[FDN_USERTENANT] T ON (U.USER_ID=T.USER_ID)
							WHERE T.USER_STATE = 1 )
AND		CODUSUARIO NOT IN (			/* CADASTROS DE FUNCIONARIOS READIMITIDOS */
							SELECT LOWER(CODUSUARIO) CODUSUARIO 
							FROM  PFUNC JOIN PPESSOA on (PFUNC.CODPESSOA=PPESSOA.CODIGO)
							WHERE	CODSITUACAO		NOT IN ( 'D','I')
							AND		CODUSUARIO		IS NOT NULL)


GO